<script>
  function showUser(data) {
    document.getElementById("user").innerHTML = data;
  }

  function generateInstituteSelect(data) { // створюємо випадний список для вибору інституту
    const institutes = Object.values(data).map(el => {
      return {
        key: el.idinstitute,
        value: el.nameinstitute
      }
    });
    institutes.unshift({
      key: 0,
      value: "Інститут /Факультет"
    });
    document.getElementById("institute").innerHTML = generateSelect(institutes, "select-institute");
  }

  function generateEducationalDegreeSelect(data) { // створюємо випадний список для вибору освітнього ступеня
    const educationalDegree = Object.values(data).map(el => {
      return {
        key: el.educationaldegreeid,
        value: el.educationaldegreename
      }
    });
    educationalDegree.unshift({
      key: 0,
      value: "Освітній рівень"
    });
    document.getElementById("educationalDegree").innerHTML = generateSelect(educationalDegree,
      "select-educationalDegree");
  }

  function generateFormTrainingSelect(data) { // створюємо випадний список для вибору форми навчання
    const formTraining = Object.values(data).map(el => {
      return {
        key: el.formtrainingid,
        value: el.formtrainingname
      }
    });
    formTraining.unshift({
      key: 0,
      value: "Форма навчання"
    });
    document.getElementById("formTraining").innerHTML = generateSelect(formTraining, "select-formTraining");
  }

  function generateCoursSelect(data) { // створюємо випадний список для вибору курсу навчання
    const formTraining = Object.values(data).map(el => {
      return {
        key: el.courseid,
        value: el.coursename
      }
    });
    formTraining.unshift({
      key: 0,
      value: "Курс"
    });
    document.getElementById("cours").innerHTML = generateSelect(formTraining, "select-cours");
  }


  function generateGroupsSelect(data) { // створюємо випадний список для вибору групи
    const groups = Object.values(data).map(el => {
      let buffer = [el.name, el.speciality, el.specialization_label];
      return {
        key: el.groupId,
        value: buffer.filter(el => {
          return el != ""
        }).join(" &rarr; ")
      }
    });
    groups.unshift({
      key: 0,
      value: "Група"
    });
    document.getElementById("groups").innerHTML = generateSelect(groups, "select-groups");
  }

  function generateControlFormSelect(data) {
    const controlForm = Object.values(data).map(el => {
      return {
        key: el.id,
        value: el.value
      }
    });
    controlForm.unshift({
      key: 0,
      value: "Форма підсумкового контролю"
    });
    return generateSelect(controlForm, "controlForm");
  }

  function generateTeacherEvolutionsLists(teachersEvLists) {
    let evLists = "";
    if (teachersEvLists.length < 1) {
      document.getElementById("teacherEvolutionsLists").innerHTML = "";
    } else {
      teachersEvLists.forEach(el => {
        let borderColorId = `edit-${el.evaluationListType}-${el.status}`;
        switch (borderColorId) {
          case "edit-1-0":
            evLists +=
              `<div class="wrappEvList border-gray">
              <button id="edit-${el.recordNumber}">${el.evaluationListData.groupName}, ${el.evaluationListData.academicDiscipline}</button>
              <i id="delete-${el.recordNumber}" class="fa fa-times"></i>
            </div>`;
            break;
            break;
          case "edit-2-0":
            evLists +=
              `<div class="wrappEvList border-yellow">
              <button id="edit-${el.recordNumber}">${el.evaluationListData.groupName}, ${el.evaluationListData.academicDiscipline}</button>
              <i id="delete-${el.recordNumber}" class="fa fa-times"></i>
            </div>`;
            break;
            break;
          default:
            evLists +=
              `<div class="wrappEvList border-blue">
                <button>${el.evaluationListData.groupName}, ${el.evaluationListData.academicDiscipline}</button>
                <i id="openSubMenu-${el.recordNumber}" class="fa fa-sort-desc"></i>
                <div id="evList-subMenu-${el.recordNumber}" class="evList-subMenu">
                  <ul>
                    <li><a href="${el.pdfId}" target="_blank"><i class="fa fa-file-pdf-o"></i>Переглянути</a></li>
                    <li><button><i class="fa fa-plus"></i>Повтрону відомість</button></li>
                  </ul>
                </div>
              </div>`;
            break;
        }
      });
      document.getElementById("teacherEvolutionsLists").innerHTML = evLists;
    }
  }

  function openSubMenu(id) {
    showOrNotShow = true;
    id.splice(0, 1, "evList-subMenu");
    document.getElementById(id.join("-")).style.display = "block";
  }

  function closeSubMenu(){
    showOrNotShow = false;
    let x = document.getElementsByClassName("evList-subMenu");
    if(x.length !== 0){
      for (let i = 0; i<x.length; i++){
        x[i].style.display = "none";
      }
    } 
    // x.forEach(el => el.style.display = "none");
  }

  function generateButtonNewEvList(view) {
    let button;
    if (view) {
      button = `<button name="actionsButtons" id='createFirstForm' style='opacity:100%;'>Відомість</button>`
    } else {
      button = `<button name="actionsButtons" id='createFirstForm' style='opacity:70%;' disabled>Відомість</button>`
    }
    document.getElementById("buttonsActionUnderForm").innerHTML = button;
  }

  // function generateActionsButtons(bool) {
  //   let names = [{
  //       createFirstForm: "Відомість"
  //     }],
  //     buttons = [];
  //   names.forEach(el => {
  //     buttons.push(Object.keys(el).map(function (key) {
  //       return `<button name="actionsButtons" id='${key}'>${el[key]}</button>`;
  //     }).join(""));
  //   });
  //   document.getElementById("buttonsActionUnderForm").innerHTML = buttons.join("");
  // }

  function generateForm() {
    let data = cloneObj(recordData.evaluationListData),
      formButtons,
      form,
      tableHeader = ["№", "Прізвище, ініціали студента", "Поточний контроль", "Підсумковий семестровий контроль",
        "Загальна оцінка"
      ],
      tableRow,
      tableMain = [],
      num = 1;

    formButtons = `<button name="actionsButtons" id='closeForm'>Закрити</button>
      <button name="actionsButtons" id='saveForm'>Зберегти</button>
      <button name="actionsButtons" id='subscribe'>Підписати</button>
      <button name="actionsButtons" id='createSecondForm'>Повторна</button>`;

    form =
      `<div class="row">
        <label for="academicDiscipline">Навчальна дисципліна</label>
        <input type="text" name="formInput" id="academicDiscipline" placeholder="повна назва дисципліни за навчальним планом" value="${data.academicDiscipline}">
      </div>
      <div class="row">
        <label for="studyCredits">Кількість кредитів</label>
        <input type="number" name="formInput" id="studyCredits" name="number" min="1" max="36" step="1" value="${data.studyCredits}">
      </div>`;

    form += `<div class="row">${generateControlFormSelect(handBook.controlForm)}</div>`

    let date = new Date(Number(data.date)).toISOString().slice(0, 10);
    form +=
      `<div class="row">
        <label for="date">Дата контролю</label>
        <input type="date" name="formInput" id="date" value="${date}">
      </div>
      <div class="row">
        <label for="teacherFullName">посади і ПІБ викладачів, які виставляють підсумкову оцінку</label>
        <input type="text" name="formInput" id="teacherFullName" value="${data.teacherFullName}">
      </div>
      <div class="row">
        <label for="aditionalTeachers">посади і ПІБ викладачів, які проводили практичні (семінарські, лабораторні) заняття й здійснювали поточний контроль</label>
        <input type="text" name="formInput" id="aditionalTeachers" placeholder="введіть через кому" value="${data.aditionalTeachers.join(", ")}">
      </div>`;

    let arrFildTabie = ["name", "currentGrade", "semesterGrade", "gradeSum"];

    data.students.forEach(el => {
      tableRow = [num];
      arrFildTabie.forEach(key => {
        switch (key) {
          case "name":
            tableRow.push(el[key]);
            break;
          case "gradeSum":
            tableRow.push(
              `<input type="text" name="tableInput" id="${key + "-" + num}" value="${el[key]}" disabled>`);
            break;
          default:
            tableRow.push(`<input type="text" name="tableInput" id="${key + "-" + num}" value="${el[key]}">`);
        }
      });
      ++num;
      tableMain.push(tableRow);
    });
    tableMain.unshift(tableHeader);
    form += createTable(tableMain, "formTable");

    document.getElementById("formButtons").innerHTML = formButtons;
    document.getElementById("form").innerHTML = form;
    document.getElementById("controlForm").value = +data.controlFormId;
  }

  function dialogBox(quest, callback) {
    const dialogBox =
      `<div class="modalBlock">
        <div class="dialogBox">
          <div class="question">
            <label>${quest}</label>
          </div>
          <div class="yesNoButtons">
            <div id = 'ok'>Так</div>
            <div id = 'cancel'>Ні</div>
          </>
        </div>
      </div>`;

    let dialog = document.getElementById('customAlert');

    dialog.innerHTML = dialogBox;

    dialog.addEventListener('click', (event) => {
      if (event.target.id === 'ok') {
        callback(true);
        dialog.innerHTML = '';
      } else if (event.target.id === 'cancel') {
        callback(false);
        dialog.innerHTML = '';
      }
    })
  }
</script>